
[core]
name: HW_DropshipAIBase
class: CustomUnitMetadata
price: 0
maxHp: 0
mass: 0

canNotBeGivenOrdersByPlayer: false


techLevel: 1
buildSpeed: 1


radius: 0


#armour: 1

softCollisionOnAll: 3

canNotBeDirectlyAttacked: false
isUnselectable: false
canNotBeDamaged: false

disableDeathOnZeroHp: false



#Private act 1: Retreat, some units should not withdraw if in a formation. Always withdraw to repair point.


[hiddenAction_retreat]
autoTrigger: if self.isControlledByAI() and self.tags(includes='Retreat') and not self.hasActiveWaypoint(type='move') and (not self.transportingCount(greaterThan=0) or not self.isOverPassableTile(Type='LAND'))
requireConditional: if not self.hasUnitInTeam(withTag='Repair', greaterThan=0, withinRange=130)
clearAllWaypoints: true
addWaypoint_type: move
addWaypoint_target_nearestUnit_maxRange: 9999
addWaypoint_target_nearestUnit_team: own
addWaypoint_target_nearestUnit_tagged: Repair



#Advance to nearest FormLeader if carrying DROP_REQ and none are nearby and not carrying one. 
[hiddenAction_reposition]
autoTrigger: if self.isControlledByAI() and self.transportingUnitWithTags(includes='DROP_REQ') and not self.transportingUnitWithTags(includes='FormLeader') and not self.hasActiveWaypoint(type='touchTarget') and not self.numberOfUnitsInTeam(withTag='FormLeader', withinRange=300, greaterThan=0) and not self.tags(includes='Retreat') and not self.tags(includes='Override')
clearAllWaypoints: true
addWaypoint_prepend: false
addWaypoint_type: touchTarget
addWaypoint_target_nearestUnit_maxRange: 9999
addWaypoint_target_nearestUnit_team: own
addWaypoint_target_nearestUnit_tagged: FormLeader





#Else Advance to enemy base if carrying DROP_REQ

[hiddenAction_attack]
autoTrigger: if self.isControlledByAI() and self.transportingUnitWithTags(includes='DROP_REQ') and not self.hasActiveWaypoint(type='touchTarget') and not self.tags(includes='Retreat') and not self.tags(includes='Override')
requireConditional: if not self.numberOfUnitsInEnemyTeam(withTag='Building', withinRange=500, greaterThan=3)
clearAllWaypoints: true
addWaypoint_prepend: false
addWaypoint_type: touchTarget
addWaypoint_target_nearestUnit_maxRange: 9999
addWaypoint_target_nearestUnit_team: enemy
addWaypoint_target_nearestUnit_tagged: Building







#Unload when idle after retreating
[hiddenAction_unloadRetreat]
autoTrigger: if self.isControlledByAI() and self.transportingCount(greaterThan=0) and self.tags(includes='Retreat') and self.isOverPassableTile(Type='OVER_CLIFF') and not self.hasFlag(id=1) and not self.tags(includes='Override')
#Jettison regular units in danger or landed
startUnloadingTransport: true
clearAllWaypoints: true
addResources: setFlag=1
alsoQueueAction: finishedUnload


#Unload when near enemy base
[hiddenAction_unloadEnemy]
autoTrigger: if self.isControlledByAI() and not self.tags(includes='Retreat') and self.transportingCount(greaterThan=0) and self.isOverPassableTile(Type='LAND') and not self.hasFlag(id=1) and not self.tags(includes='Override')
requireConditional: if numberOfUnitsInEnemyTeam(withTag='Building', greaterThan=2, withinRange=300)
#Jettison regular units in danger or landed
startUnloadingTransport: true
clearAllWaypoints: true
addResources: setFlag=1
alsoQueueAction: finishedUnload



#unload when near FormLeader
[hiddenAction_unloadFormation]
autoTrigger: if self.isControlledByAI() and self.transportingCount(greaterThan=0) and not self.transportingUnitWithTags(includes='FormLeader') and self.isOverPassableTile(Type='LAND') and not self.hasFlag(id=1) and not self.tags(includes='Override')
requireConditional: if self.numberOfUnitsInTeam(withTag='FormLeader', withinRange=200, greaterThan=0)
#Jettison regular units in danger or landed
startUnloadingTransport: true
clearAllWaypoints: true
addResources: setFlag=1
alsoQueueAction: finishedUnload







[hiddenAction_finishedUnload]
buildSpeed: 5s
addResources: unsetFlag=1





#Override tag is used to stop formations for CanFollow dropship units. 


#Start formation if not carrying anything and has 'CanFollow' tag. DROPSHIPS SHOULD NOT BE LEADERS.
[hiddenAction_Formation]
autoTrigger: if self.isControlledByAI() and self.tags(includes='CanFollow') and not self.transportingCount(greaterThan=0) and self.hasUnitInTeam(withTag='FormLeader') and not self.tags(includes='Retreat') and not self.tags(includes='Override') and not self.hasActiveWaypoint(type='guard')
requireConditional: if not self.hasFlag(id=1) or self.NumberOfUnitsInTeam(withTag='ALL_ATTACK', greaterThan=0)
clearAllWaypoints: false
addWaypoint_prepend: true
addWaypoint_type: guard
addWaypoint_target_nearestUnit_maxRange: 9999
addWaypoint_target_nearestUnit_team: own
addWaypoint_target_nearestUnit_tagged: LeaderT
addWaypoint_target_mapMustBeReachable: true
addWaypoint_triggerActionIfFailed: Formation2

[hiddenAction_Formation2]
autoTrigger: false
requireConditional: IGNORE
@copyFromSection: hiddenAction_Formation
addWaypoint_target_nearestUnit_tagged: Leader3
addWaypoint_triggerActionIfFailed: Formation3

[hiddenAction_Formation3]
autoTrigger: false
requireConditional: IGNORE
@copyFromSection: hiddenAction_Formation
addWaypoint_target_nearestUnit_tagged: Leader2
addWaypoint_triggerActionIfFailed: Formation4

[hiddenAction_Formation4]
autoTrigger: false
requireConditional: IGNORE
@copyFromSection: hiddenAction_Formation
addWaypoint_target_nearestUnit_tagged: Leader1





[graphics]
total_frames: 1
image:       SHARED:blank.png
image_wreak: NONE
image_turret: NONE





image_shadow: AUTO
shadowOffsetX:0.5
shadowOffsetY:0.5




[attack]
canAttack: false


[movement]
movementType: NONE


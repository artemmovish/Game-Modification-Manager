
[core]
name: HW_OrbitalAI
class: CustomUnitMetadata
price: 0
maxHp: 0
mass: 0

copyFrom: Unit_AI_Base.ini

#new tags: Station (fighters will escort and move to attack)
#AntiOT - Unit will partake in orbital-titan reactions.
#Fighter - This unit will protect own stations and rush enemy stations. 
#CanFollow - required for all units that cna guard other units. 


#Action type 1: Group and defend at nearest safe point. 
#Leader move: Meet at safe point.
#Followers move: Gather around safe point.

#IF LEADER AND NOT NEAR SAFE SPOT = MOVE TO SAFE SPOT.
[hiddenAction_ParkFormationCentre]
autoTrigger: if self.isControlledByAI() and not self.tags(includes='Formation') and not self.tags(includes='Retreat') and not self.tags(includes='DEFEND') and not self.tags(includes='Attacking') and not self.hasActiveWaypoint(type='follow') and not self.tags(includes='AttackOT')
requireConditional: if self.noUnitInTeam(withTag='ALL_ATTACK') and not self.NumberOfUnitsInTeam(withTag='OSafety', greaterThan=0, withinRange=100)
clearAllWaypoints: false
addWaypoint_prepend: true
addWaypoint_type: follow
addWaypoint_target_nearestUnit_maxRange: 9999
addWaypoint_target_nearestUnit_team: own
addWaypoint_target_nearestUnit_tagged: OSafety
addWaypoint_target_mapMustBeReachable: true
addWaypoint_triggerActionIfFailed: IGNORE

# and not self.NumberOfUnitsInTeam(withTag='OSafety', greaterThan=0, withinRange=100)





#Action 2: Formation build. ALl based on tags.

[hiddenAction_NoFormation]
autoTrigger: if self.tags(includes='Formation') 
requireConditional: if self.NumberOfUnitsInTeam(withTag='FormLeader', greaterThan=0) 
temporarilyRemoveTags: Formation


[hiddenAction_guardStation]
autoTrigger: if self.isControlledByAI() and self.tags(includes='Fighter') and not self.tags(includes='Retreat') and not self.tags(includes='Attacking') and not self.hasActiveWaypoint(type='guard') and not self.tags(includes='DEFEND') and not self.tags(includes='AttackOT') and self.tags(includes='CanFollow')
requireConditional: if self.hasUnitInTeam(withTag='Station')
temporarilyAddTags: Formation
clearAllWaypoints: false
addWaypoint_prepend: true
addWaypoint_type: guard
addWaypoint_target_nearestUnit_maxRange: 9999
addWaypoint_target_nearestUnit_team: own
addWaypoint_target_nearestUnit_tagged: Station
addWaypoint_target_mapMustBeReachable: true
addWaypoint_triggerActionIfFailed: Formation
temporarilyRemoveTags: FormLeader



[hiddenAction_Formation]
autoTrigger: if self.isControlledByAI() and not self.tags(includes='FormLeader') and not self.tags(includes='Retreat') and not self.tags(includes='Attacking') and not self.hasActiveWaypoint(type='guard') and not self.tags(includes='DEFEND') and not self.tags(includes='AttackOT') and self.tags(includes='CanFollow')
requireConditional: if self.noUnitInTeam(withTag='Station') and self.hasUnitInTeam(withTag='FormLeader')
temporarilyAddTags: Formation
clearAllWaypoints: false
addWaypoint_prepend: true
addWaypoint_type: guard
addWaypoint_target_nearestUnit_maxRange: 9999
addWaypoint_target_nearestUnit_team: own
addWaypoint_target_nearestUnit_tagged: LeaderT
addWaypoint_target_mapMustBeReachable: true
addWaypoint_triggerActionIfFailed: Formation2
temporarilyRemoveTags: FormLeader, DROP_REQ

[hiddenAction_Formation2]
autoTrigger: false
requireConditional: IGNORE
@copyFromSection: hiddenAction_Formation
addWaypoint_target_nearestUnit_tagged: Leader3
addWaypoint_triggerActionIfFailed: Formation3

[hiddenAction_Formation3]
autoTrigger: false
requireConditional: IGNORE
@copyFromSection: hiddenAction_Formation
addWaypoint_target_nearestUnit_tagged: Leader2
addWaypoint_triggerActionIfFailed: Formation4

[hiddenAction_Formation4]
autoTrigger: false
requireConditional: IGNORE
@copyFromSection: hiddenAction_Formation
addWaypoint_target_nearestUnit_tagged: Leader1
addWaypoint_triggerActionIfFailed: IGNORE














#Action 3: formation attack
[hiddenAction_LeaderAdvance]
autoTrigger: if self.isControlledByAI() and self.tags(includes='FormLeader') and not self.tags(includes='Retreat') and not self.tags(includes='Attacking') and not self.hasActiveWaypoint(type='attackMove') and not self.tags(includes='AttackOT')
requireConditional: if self.hasUnitInTeam(withTag='ALL_ATTACK')
clearAllWaypoints: false
addWaypoint_prepend: true
addWaypoint_type: attackMove
addWaypoint_target_nearestUnit_maxRange: 99999
addWaypoint_target_nearestUnit_team: enemy
addWaypoint_target_nearestUnit_tagged: Station
addWaypoint_target_mapMustBeReachable: true
addWaypoint_triggerActionIfFailed: Advance2
temporarilyRemoveTags: DROP_REQ, FormLeader


[hiddenAction_RandomAdvance]
autoTrigger: if self.isControlledByAI() and not self.tags(includes='Retreat') and not self.tags(includes='Attacking') and not self.hasActiveWaypoint(type='attackMove') and not self.tags(includes='AttackOT')
requireConditional: if self.hasUnitInTeam(withTag='ALL_ATTACK') and self.noUnitInTeam(withTag='FormLeader')
@copyFromSection: hiddenAction_LeaderAdvance
addWaypoint_target_nearestUnit_tagged: Station
addWaypoint_triggerActionIfFailed: Advance2

[hiddenAction_Advance2]
autoTrigger: false
requireConditional: IGNORE
@copyFromSection: hiddenAction_LeaderAdvance
addWaypoint_target_nearestUnit_tagged: orbital
addWaypoint_triggerActionIfFailed: IGNORE





#action 4: Break formation (If units are damaged and enemies are nearby, the formation breaks.)
[hiddenAction_BreakFormation]
autoTrigger: if self.numberofUnitsInEnemyTeam(greaterThan=0, withinRange=1000) and not self.tags(includes='AttackOT')
requireConditional: if self.NumberOfUnitsInTeam(withTag='BREAK_FORMATION', greaterThan=0, withinRange=1000)
temporarilyAddTags: Attacking
#temporarilyRemoveTags: Formation



#ATTACK AFTER BREAKING FORMATION OR WHEN DEFENDING.
[hiddenAction_SoloAttack]
autoTrigger: if self.isControlledByAI() and self.tags(includes='Attacking') and not self.tags(includes='Retreat') and self.tags(includes='Obomb')
requireConditional: if self.tags(includes='CanFollow') and not self.tags(includes='AttackOT') and not self.hasActiveWaypoint(type='attackMove')

[hiddenAction_SoloAttackO]
autoTrigger: if self.isControlledByAI() and self.tags(includes='Attacking') and not self.tags(includes='Retreat') and not self.hasActiveWaypoint(type='attackMove') and not self.tags(includes='Obomb')
requireConditional: if not self.tags(includes='AttackOT') and self.tags(includes='CanFollow')
clearAllWaypoints: false
addWaypoint_prepend: true
addWaypoint_type: follow
addWaypoint_target_nearestUnit_maxRange: 9990
addWaypoint_target_nearestUnit_team: enemy
addWaypoint_target_nearestUnit_tagged: orbital






[hiddenAction_ReformFormations]
autoTrigger: if self.isControlledByAI() and not self.tags(includes='FormLeader') and not self.tags(includes='Retreat') and not self.tags(includes='DEFEND') and self.tags(includes='CanFollow') and not self.tags(includes='AttackOT')
requireConditional: if self.hasUnitInTeam(withTag='ALL_ATTACK') and (not self.NumberOfUnitsInTeam(withTag='FormLeader', greaterThan=0, withinRange=1000) or not self.numberofUnitsInEnemyTeam(greaterThan=0, withinRange=1000))




[hiddenAction_ProtectTitan]
autoTrigger: if self.isControlledByAI() and not self.hasActiveWaypoint(type='guard') and not self.tags(includes='Retreat')
requireConditional: if numberOfUnitsInEnemyTeam(withTag='TiStationPart', greaterThan=0) and not numberOfUnitsInEnemyTeam(withTag='TiStationPart', greaterThan=0, withinRange=500)
#clearAllWaypoints: true
addWaypoint_prepend: true
addWaypoint_type: guard
addWaypoint_target_nearestUnit_maxRange: 99999
addWaypoint_target_nearestUnit_team: own
addWaypoint_target_nearestUnit_tagged: TiStationPart
temporarilyAddTags: AttackOT

#Counter Orbital Titans
[hiddenAction_attackTitan]
autoTrigger: if self.isControlledByAI() and not self.hasActiveWaypoint(type='attack') and self.tags(includes='AntiOT') and not self.tags(includes='Retreat')
requireConditional: if numberOfUnitsInEnemyTeam(withTag='TiStationPart', greaterThan=0) and not numberOfUnitsInEnemyTeam(withTag='TiStationPart', greaterThan=0, withinRange=500)
#clearAllWaypoints: true
addWaypoint_prepend: true
addWaypoint_type: attack
addWaypoint_target_nearestUnit_maxRange: 99999
addWaypoint_target_nearestUnit_team: enemy
addWaypoint_target_nearestUnit_tagged: TiStationPart
temporarilyAddTags: AttackOT





#action 5: Full retreat if local or global enemy is overwhelming
[hiddenAction_Fullretreat]
autoTrigger: if self.isControlledByAI() and self.NumberOfUnitsInTeam(withTag='ALL_RUN', greaterThan=0) and not self.hasActiveWaypoint(type='move') and not self.tags(includes='DEFEND')
requireConditional: if not self.hasUnitInTeam(withTag='Repair', greaterThan=0, withinRange=130)




[hiddenAction_Defend]
autoTrigger: if self.hasUnitInTeam(withTag='HELP') and self.isControlledByAI() and not self.tags(includes='Retreat') and not self.hasActiveWaypoint(type='touchTarget') and not self.tags(includes='CounterAttack') and self.tags(includes='Obomb')
requireConditional: if self.NumberOfUnitsInTeam(withTag='HELP', greaterThan=0, withinRange=1000) or self.NumberOfUnitsInTeam(withTag='HELP', greaterThan=4)


[hiddenAction_startDefence]
autoTrigger: if self.tags(includes='DEFEND') and self.tags(includes='Obomb')
requireConditional: if self.NumberOfUnitsInTeam(withTag='HELP', greaterThan=0, withinRange=120) and self.numberofUnitsInEnemyTeam(greaterThan=0, withinRange=1000)


[hiddenAction_Stop_Defence]
autoTrigger: if self.isControlledByAI() and self.tags(includes='CounterAttack')
requireConditional: if self.NumberOfUnitsInTeam(withTag='ALL_ATTACK', greaterThan=0) and (not self.NumberOfUnitsInTeam(withTag='HELP', greaterThan=0, withinRange=1000) or not self.numberofUnitsInEnemyTeam(greaterThan=0, withinRange=1000) or not self.NumberOfUnitsInTeam(withTag='HELP_ORBIT', greaterThan=0, withinRange=1000))

[hiddenAction_Stop_Defence2]
autoTrigger: if self.isControlledByAI() and self.tags(includes='CounterAttack')
requireConditional: if self.hasUnitInTeam(withTag='ALL_ATTACK') and (not self.NumberOfUnitsInTeam(withTag='HELP', greaterThan=0, withinRange=1000) or not self.numberofUnitsInEnemyTeam(greaterThan=0, withinRange=1000) or not self.NumberOfUnitsInTeam(withTag='HELP_ORBIT', greaterThan=0, withinRange=1000))



#Action 6: respond to SOS
[hiddenAction_DefendO]
autoTrigger: if self.hasUnitInTeam(withTag='HELP_ORBIT') and self.isControlledByAI() and not self.tags(includes='Retreat') and not self.tags(includes='CounterAttack') and not self.tags(includes='AttackOT')
requireConditional: if self.NumberOfUnitsInTeam(withTag='HELP_ORBIT', greaterThan=0, withinRange=1000) or self.NumberOfUnitsInTeam(withTag='HELP', greaterThan=4)

temporarilyAddTags: DEFEND
clearAllWaypoints: false
addWaypoint_prepend: true
addWaypoint_type: attackMove
addWaypoint_target_nearestUnit_maxRange: 9999
addWaypoint_target_nearestUnit_team: own
addWaypoint_target_nearestUnit_tagged: HELP_ORBIT
addWaypoint_target_mapMustBeReachable: true

[hiddenAction_startDefenceO]
autoTrigger: if self.tags(includes='DEFEND') and not self.tags(includes='AttackOT')
requireConditional: if self.NumberOfUnitsInTeam(withTag='HELP_ORBIT', greaterThan=0, withinRange=120) and self.numberofUnitsInEnemyTeam(greaterThan=0, withinRange=1000)
temporarilyAddTags: Attacking, CounterAttack


# and not self.NumberOfUnitsInTeam(withTag='ALL_ATTACK', greaterThan=0)
[hiddenAction_Stop_DefenceO]
autoTrigger: if self.isControlledByAI() and self.tags(includes='CounterAttack') and not self.tags(includes='AttackOT')
requireConditional: if self.NumberOfUnitsInTeam(withTag='ALL_ATTACK', greaterThan=0) and (not self.NumberOfUnitsInTeam(withTag='HELP_ORBIT', greaterThan=0, withinRange=1000) or not self.numberofUnitsInEnemyTeam(greaterThan=0, withinRange=1000))

temporarilyRemoveTags: DEFEND, Attacking, CounterAttack, BREAK_FORMATION
clearAllWaypoints: false
addWaypoint_prepend: true
addWaypoint_type: move
addWaypoint_target_nearestUnit_maxRange: 9999
addWaypoint_target_nearestUnit_team: own
addWaypoint_target_nearestUnit_tagged: OSafety
addWaypoint_target_mapMustBeReachable: true







#Private act 1: Retreat, some units should not withdraw if in a formation. Always withdraw to repair point.


[hiddenAction_retreat]
autoTrigger: if self.isControlledByAI() and self.tags(includes='Retreat') and not self.hasActiveWaypoint(type='move')
requireConditional: if not self.hasUnitInTeam(withTag='Repair', greaterThan=0, withinRange=120)
clearAllWaypoints: true
addWaypoint_type: move
addWaypoint_target_nearestUnit_maxRange: 9999
addWaypoint_target_nearestUnit_team: own
addWaypoint_target_nearestUnit_tagged: Repair
temporarilyRemoveTags: Attacking, CounterAttack, DEFEND, Formation, BREAK_FORMATION



#Enter dropshop
[hiddenAction_enterDropship]
autoTrigger: false








#Data sort 1: Select leader (create a leader priority based on own unit priority, 
#if no leaders of equal priority are nearby. Priority should generaly go to the slowest units. 
#there should be a chance for multiple leaders to appear if they are far apart in order to accomodate defence. 





#Update health: While in formation, update health whenever it increases. If health drops then add Hurt tag. 
[hiddenAction_UpdateHealth]
autoTrigger: if self.isControlledByAI() and self.hasUnitInTeam(withTag='Fighter', greaterThan=40)
requireConditional: if numberOfUnitsInEnemyTeam(withTag='Station', greaterThan=0) and not numberOfUnitsInEnemyTeam(withTag='TiStation', greaterThan=0)
temporarilyAddTags: BREAK_FORMATION





[hiddenAction_DetectDamage]
autoTrigger: false








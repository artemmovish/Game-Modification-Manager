
[core]
name: HW_BuilderAI
class: CustomUnitMetadata
price: 0
maxHp: 0
mass: 0
copyFrom: Unit_AI_Base.ini


#Some tag is needed for calling an airlift. Nearby carriers will home in on this tag to lift and pick them up. Will then transport this tag towards the enemy base if ALL_ATTACK is on. Else, will transport towards base (if carrying leader) or nearest leader (if not carrying leader)
[hiddenAction_AIR_LIFT]
autoTrigger: false
temporarilyAddTags: DROP_REQ






#Action type 1: Group and defend at nearest safe point. 
#Leader move: Meet at safe point.
#Followers move: Gather around safe point.

#IF LEADER AND NOT NEAR SAFE SPOT = MOVE TO SAFE SPOT.
[hiddenAction_ParkFormationCentre]
autoTrigger: false




#Action 2: Formation build. ALl based on tags.



[hiddenAction_Formation]
autoTrigger: if self.isControlledByAI() and not self.tags(includes='FormLeader') and not self.tags(includes='DROP_REQ') and not self.tags(includes='Retreat') and not self.tags(includes='Attacking') and not self.hasActiveWaypoint(type='guard') and not self.tags(includes='DEFEND') and self.tags(includes='CanFollow')
requireConditional: if self.NumberOfUnitsInTeam(withTag='FormLeader', greaterThan=0, withinRange=800) and self.NumberOfUnitsInTeam(withTag='ALL_ATTACK', greaterThan=0)

temporarilyAddTags: Formation
clearAllWaypoints: false
addWaypoint_prepend: true
addWaypoint_type: guard
addWaypoint_target_nearestUnit_maxRange: 9999
addWaypoint_target_nearestUnit_team: own
addWaypoint_target_nearestUnit_tagged: LeaderT
addWaypoint_target_mapMustBeReachable: true
addWaypoint_triggerActionIfFailed: Formation2
temporarilyRemoveTags: FormLeader, DROP_REQ

[hiddenAction_Formation2]
autoTrigger: false
requireConditional: IGNORE
@copyFromSection: hiddenAction_Formation
addWaypoint_target_nearestUnit_tagged: Leader3
addWaypoint_triggerActionIfFailed: Formation3

[hiddenAction_Formation3]
autoTrigger: false
requireConditional: IGNORE
@copyFromSection: hiddenAction_Formation
addWaypoint_target_nearestUnit_tagged: Leader2
addWaypoint_triggerActionIfFailed: Formation4

[hiddenAction_Formation4]
autoTrigger: false
requireConditional: IGNORE
@copyFromSection: hiddenAction_Formation
addWaypoint_target_nearestUnit_tagged: Leader1
addWaypoint_triggerActionIfFailed: AIR_LIFT






[hiddenAction_buildAO]
autoTrigger: if self.isControlledByAI() and self.NumberOfUnitsInTeam(withTag='Q_AO', greaterThan=0) and self.hasResources(credits=25000) and not self.tags(includes='Formation') and not self.tags(includes='Retreat') and not self.tags(includes='Attacking') and not self.tags(includes='DEFEND') and not self.hasActiveWaypoint(type='build')
requireConditional: if not self.NumberOfUnitsInTeam(withTag='AOTurret', greaterThan=0, withinRange=280) and self.NumberOfUnitsInTeam(withTag='Factory', greaterThan=0, withinRange=250)
clearAllWaypoints: false
addWaypoint_prepend: false
addWaypoint_type: build
addWaypoint_unitType: CBE Tower
addWaypoint_target_nearestUnit_tagged: builder
addWaypoint_target_nearestUnit_maxRange: 126
temporarilyRemoveTags: DROP_REQ
addResources: credits=-5800

#addWaypoint_position_randomOffsetFromSelf: 150, 150
#addWaypoint_target_mapMustBeReachable: true






#Action 3: formation attack
[hiddenAction_LeaderAdvance]
autoTrigger: if self.isControlledByAI() and self.tags(includes='FormLeader') and not self.tags(includes='Retreat') and not self.tags(includes='Attacking') and not self.hasActiveWaypoint(type='follow')
requireConditional: if self.hasUnitInTeam(withTag='ALL_ATTACK', greaterThan=0)
clearAllWaypoints: false
addWaypoint_prepend: true
addWaypoint_type: follow
addWaypoint_target_nearestUnit_maxRange: 99999
addWaypoint_target_nearestUnit_team: enemy
addWaypoint_target_nearestUnit_tagged: FormLeader
addWaypoint_target_mapMustBeReachable: true
addWaypoint_triggerActionIfFailed: Advance2
temporarilyRemoveTags: DROP_REQ



[hiddenAction_RandomAdvance]
autoTrigger: if self.isControlledByAI() and not self.tags(includes='Retreat') and not self.tags(includes='Attacking') and not self.hasActiveWaypoint(type='setPassiveTarget') and self.tags(includes='CanFollow')
requireConditional: if self.hasUnitInTeam(withTag='ALL_ATTACK') and self.noUnitInTeam(withTag='FormLeader')


[hiddenAction_Advance2]
addWaypoint_type: setPassiveTarget




#action 4: Break formation (If units are damaged and enemies are nearby, the formation breaks.)
[hiddenAction_BreakFormation]
autoTrigger: if self.isControlledByAI and self.tags(includes='CanFollow')
requireConditional: if self.NumberOfUnitsInTeam(withTag='BREAK_FORMATION', greaterThan=0, withinRange=1000) and self.numberofUnitsInEnemyTeam(greaterThan=0, withinRange=1000)
temporarilyAddTags: Attacking
#temporarilyRemoveTags: Formation






[hiddenAction_ReformFormations]
autoTrigger: if self.isControlledByAI() and not self.tags(includes='FormLeader') and not self.tags(includes='Retreat') and not self.tags(includes='DEFEND') and self.tags(includes='BREAK_FORMATION')
requireConditional: if self.hasUnitInTeam(withTag='ALL_ATTACK') and (not self.numberofUnitsInEnemyTeam(greaterThan=0, withinRange=1000) or not self.NumberOfUnitsInTeam(withTag='FormLeader', greaterThan=0, withinRange=1000))
temporarilyRemoveTags: Attacking, BREAK_FORMATION, DROP_REQ
setResourcesWithLogic: SaveHP = self.hp()
clearAllWaypoints: false
addWaypoint_prepend: true
addWaypoint_type: guard
addWaypoint_target_nearestUnit_maxRange: 9999
addWaypoint_target_nearestUnit_team: own
addWaypoint_target_nearestUnit_tagged: LeaderT
addWaypoint_target_mapMustBeReachable: true
addWaypoint_triggerActionIfFailed: Formation2
temporarilyAddTags: Formation



[hiddenAction_ReformFormations2]
autoTrigger: if self.isControlledByAI() and not self.tags(includes='Retreat') and not self.tags(includes='DEFEND') and self.tags(includes='BREAK_FORMATION')
requireConditional: if not self.numberofUnitsInEnemyTeam(greaterThan=0, withinRange=1000) or not self.NumberOfUnitsInTeam(withTag='FormLeader', greaterThan=0, withinRange=1000)
@copyFromSection: hiddenAction_ReformFormations








#ATTACK AFTER BREAKING FORMATION OR WHEN DEFENDING.
[hiddenAction_SoloAttack]
autoTrigger: if self.isControlledByAI() and self.tags(includes='Attacking') and not self.tags(includes='Retreat') and not self.hasActiveWaypoint(type='follow') and self.tags(includes='CanFollow') and not self.hasActiveWaypoint(type='build') and not self.hasActiveWaypoint(type='repair')
clearAllWaypoints: false
addWaypoint_prepend: true
addWaypoint_type: repair
addWaypoint_target_nearestUnit_maxRange: 99999
addWaypoint_target_nearestUnit_team: own
addWaypoint_target_nearestUnit_tagged: BREAK_FORMATION
addWaypoint_target_mapMustBeReachable: true
addWaypoint_triggerActionIfFailed: SoloAttack2



[hiddenAction_SoloAttack2]
@copyFromSection: hiddenAction_Formation
autoTrigger: false
addWaypoint_type: follow
addWaypoint_target_nearestUnit_team: enemy
addWaypoint_target_nearestUnit_tagged: Titan
addWaypoint_triggerActionIfFailed: Advance2









#action 5: Full retreat if local or global enemy is overwhelming
[hiddenAction_Fullretreat]
autoTrigger: if self.isControlledByAI() and not self.hasActiveWaypoint(type='move') and not self.tags(includes='DEFEND') and self.tags(includes='CanFollow')
requireConditional: if self.hasUnitInTeam(withTag='ALL_RUN') and not self.hasUnitInTeam(withTag='Repair', greaterThan=0, withinRange=130)
clearAllWaypoints: true
addWaypoint_type: move
addWaypoint_target_nearestUnit_maxRange: 9999
addWaypoint_target_nearestUnit_team: own
addWaypoint_target_nearestUnit_tagged: Repair
temporarilyRemoveTags: Attacking, Formation, BREAK_FORMATION
temporarilyAddTags: RUN













#Action 6: respond to SOS
#REFINE THIS SCRIPT SO THAT UNITS WILL RESPOND TO AN SOS THAT CORRESPONDS TO THEIR TARGETING ABILITIES.
[hiddenAction_Defend]
autoTrigger: false

[hiddenAction_startDefence]
autoTrigger: false

# and not self.NumberOfUnitsInTeam(withTag='ALL_ATTACK', greaterThan=0)
[hiddenAction_Stop_Defence]
autoTrigger: false
[hiddenAction_Stop_Defence2]
autoTrigger: false



[hiddenAction_repair]
autoTrigger: if self.isControlledByAI() and not self.hasActiveWaypoint(type='build') and not self.hasActiveWaypoint(type='repair') and not self.tags(includes='repair') and (self.noUnitInTeam(withTag='ALL_RUN') and not self.tags(includes='Retreat') or not self.tags(includes='CanFollow') and not self.hasActiveWaypoint(type='guard'))
requireConditional: if self.NumberOfUnitsInTeam(withTag='NeedFix', greaterThan=0, withinRange=600)

clearAllWaypoints: false
addWaypoint_prepend: true
addWaypoint_type: repair
addWaypoint_target_nearestUnit_maxRange: 9999
addWaypoint_target_nearestUnit_team: own
addWaypoint_target_nearestUnit_tagged: NeedFix
addWaypoint_target_mapMustBeReachable: false
temporarilyAddTags: DEFEND
#and self.tags(includes='CanFollow')



[hiddenAction_NoRepair]
autoTrigger: if self.isControlledByAI() and not self.tags(includes='DEFEND')
requireConditional: if not self.NumberOfUnitsInTeam(withTag='NeedFix', greaterThan=0, withinRange=600)
temporarilyRemoveTags: DEFEND






#Private act 1: Retreat, some units should not withdraw if in a formation. Always withdraw to repair point.


[hiddenAction_retreat]
autoTrigger: if self.isControlledByAI() and self.tags(includes='Retreat') and not self.hasActiveWaypoint(type='touchTarget')
requireConditional: if not self.hasUnitInTeam(withTag='Repair', greaterThan=0, withinRange=130)
clearAllWaypoints: false
addWaypoint_prepend: true
addWaypoint_type: touchTarget
addWaypoint_target_nearestUnit_maxRange: 9999
addWaypoint_target_nearestUnit_team: own
addWaypoint_target_nearestUnit_tagged: Repair
temporarilyRemoveTags: Attacking, CounterAttack, DEFEND, Formation, BREAK_FORMATION



#Enter dropshop
[hiddenAction_enterDropship]
autoTrigger: if self.isControlledByAI() and self.tags(includes='DROP_REQ') and not self.tags(includes='DEFEND')
clearAllWaypoints: true
addWaypoint_type: loadInto
addWaypoint_target_randomUnit_maxRange: 9999
addWaypoint_target_randomUnit_team: own
addWaypoint_target_randomUnit_tagged: dropship


















[graphics]
total_frames: 1
image:       SHARED:blank.png
image_wreak: NONE
image_turret: NONE





image_shadow: AUTO
shadowOffsetX:0.5
shadowOffsetY:0.5




[attack]
canAttack: false


[movement]
movementType: NONE


[core]
name: Gabriel_Dropship_Air
displayText: Gabriel Mobile Base
displayDescription: Deployable Forward Operating Base. \n -Weapons are modular, can be customised and upgraded. \n-Repairs held units.. \n-Builds faster and fires missiles while grounded. \n-Can target stealth-units. \n-Can carry Nemesis tanks and Dreadnoughts.
class: CustomUnitMetadata
price: 240000
maxHp: 11000
mass: 900000

techLevel: 1
experimental: true

buildSpeed: 160s
#availableInDemo: true

radius: 100
#displayRadius: 120
isBio: false
softCollisionOnAll: 60
fogOfWarSightRange:35





disableAllUnitCollisions: true


copyFrom: ROOT:Dropship_AI.ini
borrowResourcesWhileAlive: TotalUnit=-1, Air=-27, Ground=-27, AG=-27, AA=-9, AntiArmour=-9, AS=-9, AntiStealth=-9, Orbit=-9, AO=-3, AntiLD=-9, Shield=-9
tags: Unit, AirT, AGT, AA3, AntiArmour3, NoCap, Factory, CanFollow, Titan, Gabr, anti-stealth, AS3, AStealth3, CanFollow, Orbit3, AO2, ALD3


maxShield: 3000
shieldRegen: 0.1


energyMax: 8
energyRegen: 0.02
energyNeedsToRechargeToFull: true


exit_dirOffset:0
exit_moveAwayAmount:250



maxTransportingUnits: 30
transportUnitsHealBy: 0.5
transportUnitsBlockAirAndWaterUnits: false
transportUnitsRequireMovementType: AIR, LAND, OVER_CLIFF, OVER_CLIFF_WATER, HOVER
transportUnitsCanUnloadUnits: if not self.isOverLiquid() or self.isOverwater() or self.transportingUnitWithTags(includes='DreadN')

transportUnitsUnloadDelayBetweenEachUnit: 0.1s


canRepairBuildings: true
canRepairUnits : true

autoRepair: true
isBuilder: true



nanoRange: 270


nanoFactorySpeed:1.5
nanoRepairSpeed: 0.5
nanoBuildSpeed: 1.5





nukeOnDeath: true
nukeOnDeathRange: 300
nukeOnDeathDamage: 5500
nukeOnDeathDisableWhenNoNuke: true



builtFrom_1_name: experimentalLandFactory
builtFrom_1_pos:  8



[hiddenAction_Started]
takeResources: EAir=-27, EGround=-27, EAG=-27, EAA=-9, EAntiArmour=-9, EAS=-9, EAntiStealth=-9, EOrbit=-9, EAO=-3, EAntiLD=-9, EShield=-9
[hiddenAction_Started_UpdateAlly]
takeResources: Air=-27, Ground=-27, AG=-27, AA=-9, AntiArmour=-9, AS=-9, AntiStealth=-9, Orbit=-9, AO=-3, AntiLD=-9, Shield=-9
[hiddenAction_Killed]
takeResources: EAir=27, EGround=27, EAG=27, EAA=9, EAntiArmour=9, EAS=9, EAntiStealth=9, EOrbit=9, EAO=3, EAntiLD=9, EShield=9
[hiddenAction_Killed_UpdateAlly]
takeResources: Air=27, Ground=27, AG=27, AA=9, AntiArmour=9, AS=9, AntiStealth=9, Orbit=9, AO=3, AntiLD=9, Shield=9
#TotalUnit=-1



[hiddenAction_Warning]
autoTriggerOnEvent: created

showMessageToAllEnemyPlayers: Enemy Gabriel-Mobile-Base detected



[resource_SaveHP]
hidden: true


[hiddenAction_CheckHealedBy]
autoTrigger: if self.resource(type='hp') > self.resource(type='SaveHP')
setResourcesWithLogic: SaveHP = self.hp()

[hiddenAction_CallSOS]
autoTrigger: if self.isControlledByAI() and self.resource(type='hp') < self.resource(type='SaveHP') and self.numberofUnitsInEnemyTeam(withTag='Unit', greaterThan=0, withinRange=1000) or self.isControlledByAI() and self.resource(type='hp') < self.resource(type='SaveHP') and self.numberofUnitsInEnemyTeam(withTag='Building', greaterThan=0, withinRange=1000)
setResourcesWithLogic: SaveHP = self.hp()
temporarilyAddTags: HELP, BREAK_FORMATION

[hiddenAction_CallSOSORBIT]
autoTrigger: if self.isControlledByAI() and self.resource(type='hp') < self.resource(type='SaveHP') and self.numberofUnitsInEnemyTeam(withTag='orbital', greaterThan=0, withinRange=1000)
setResourcesWithLogic: SaveHP = self.hp()
temporarilyAddTags: HELP_ORBIT, BREAK_FORMATION


[hiddenAction_EndSOS]
autoTrigger: if self.isControlledByAI() and not self.numberofUnitsInEnemyTeam(greaterThan=0, withinRange=1000)or self.isControlledByAI() and self.hp(full=true)
temporarilyRemoveTags: HELP, HELP_ORBIT
setResourcesWithLogic: SaveHP = self.hp()





#[hiddenAction_RunTheFAway]
#autoTrigger: if self.isControlledByAI() and numberOfUnitsInEnemyTeam(withTag='TiStationPart', greaterThan=0, withinRange=500) and not self.hasActiveWaypoint(type='move') and not self.hasActiveWaypoint(type='loadUp')
#clearAllWaypoints: true
#addWaypoint_type: move
#addWaypoint_target_nearestUnit_maxRange: 9999
#addWaypoint_target_nearestUnit_team: own
#addWaypoint_target_nearestUnit_tagged: Safety




[action_selectSlot1]
@define slotId: 1
buildSpeed: 0s
#text: Slot ${slotId}
text: [
textAddUnitName: unitRef self.attachment(slot="unitSlot${slotId}")
textPostFix: ]

descriptionAddFromUnit: unitRef self.attachment(slot="unitSlot${slotId}")
descriptionAddUnitStats: unitRef self.attachment(slot="unitSlot${slotId}")

addResources: unsetFlag=1-10, setFlag=${slotId}
isGuiBlinking: if self.hasFlag(id=${slotId})
displayType: action
unitShownInUI: unitRef self.attachment(slot="unitSlot${slotId}")


iconExtraIsVisible: if self.hasFlag(id=${slotId})
iconExtraImage: icon_selected.png

pos:1


canPlayerCancel: false
allowMultipleInQueue: false

#No confirm needed on mobile
alwaysSinglePress: true
highPriorityQueue: true



#Makes the 'flags' for this unit appear to update instantly in the UI without waiting for
#confirmation from the server. Removes sluggish feeling when switching tabs.
#Note: If unit flags were also updated from non-ui sources this option might have visual side effects.
extraLagHidingInUI: true






[action_selectSlot2]
@copyFromSection: action_selectSlot1
@define slotId: 2
[action_selectSlot3]
@copyFromSection: action_selectSlot1
@define slotId: 3
[action_selectSlot4]
@copyFromSection: action_selectSlot1
@define slotId: 4
[action_selectSlot5]
@copyFromSection: action_selectSlot1
@define slotId: 5
[action_selectSlot6]
@copyFromSection: action_selectSlot1
@define slotId: 6






[action_selectSlotBuild]
@copyFromSection: action_selectSlot1
@define slotId: 10
pos:0
text: [ Build ]
textPostFix:
textAddUnitName: 
descriptionAddFromUnit: 
descriptionAddUnitStats:

unitShownInUI: 


[hiddenAction_onCreate]
autoTriggerOnEvent: created
addResources: setFlag=10



[attachment_unitSlot1]

x:-14
y:65
#idleDir:-60
idleDir:-45
idleDirReversing:0

onCreateSpawnUnitOf:Gab_emptySlot
addTransportedUnits: true
setDrawLayerOnTop: true
lockLegMovement:false

canBeAttackedAndDamaged: true
isUnselectable: false

showAllActionsFrom:if self.hasFlag(id=1)

#resetRotationWhenNotAttacking:true
lockRotation: true

createIncompleteIfParentIs: false

redirectDamageToParent: true
redirectDamageToParent_shieldOnly: true

[attachment_unitSlot2]
@copyFromSection: attachment_unitSlot1

x:14
y:65
#idleDir:60
idleDir:45
idleDirReversing:0

showAllActionsFrom:if self.hasFlag(id=2)


[attachment_unitSlot3]
@copyFromSection: attachment_unitSlot1
x:-65
y:-25
idleDir:-90
idleDirReversing:-90

showAllActionsFrom:if self.hasFlag(id=3)


[attachment_unitSlot4]
@copyFromSection: attachment_unitSlot1
x:65
y:-25
idleDir:90
idleDirReversing:90

showAllActionsFrom:if self.hasFlag(id=4)

[attachment_unitSlot5]
@copyFromSection: attachment_unitSlot1


x:-14
y:-55
#idleDir:-120

idleDir:225
idleDirReversing:180

showAllActionsFrom:if self.hasFlag(id=5)

[attachment_unitSlot6]
@copyFromSection: attachment_unitSlot1


x:14
y:-55
#idleDir:120
idleDir:135
idleDirReversing:180


showAllActionsFrom:if self.hasFlag(id=6)
















[canBuild_Builders]
name: TA_Builder, TerranCombatEngineer
pos:  30
forceNano: false

isVisible: if self.hasFlag(id=10)

extraLagHidingInUI: true



[canBuild_Infantry]
name: Strike trooper, EC_Gunner, Special Operative
pos:  31
forceNano: false

isVisible: if self.hasFlag(id=10)

extraLagHidingInUI: true



[canBuild_Tanks]
name: Terran_heavyTank, Tc_heavyHovertank, TerranplasmaTank, TerranC_laserTank, hailerTank, SuperFrog, TA_CounterTank, c_TerranmammothTank, TerranheavyArtillery, TerranmissileTank
pos:  32
forceNano: false

isVisible: if self.hasFlag(id=10)

extraLagHidingInUI: true



[canBuild_Mechs]
name: TerranmechArtillery, TerranmechMinigun, TerranmechLightning, TerranmechLaser, TerranmechFlame
pos:  33
forceNano: false

isVisible: if self.hasFlag(id=10)

extraLagHidingInUI: true



[canBuild_Aircraft]
name: TA_CounterRing, TerranC_amphibiousJet, Falk strike fighter, TerranMissileAirship, Terranbomber, Terran_aaBeamGunship, T_VenusJet
pos:  34
forceNano: false

isVisible: if self.hasFlag(id=10)

extraLagHidingInUI: true



[canBuild_showReclaimAction]
name: reclaim
pos:  -1








[action_land]
convertTo: Gabriel_Dropship_Ground
autoTrigger: if not self.flying
isVisible: false
highPriorityQueue: true


[action_orbital]
text: Engage Boosters
buildSpeed: 1s
convertTo: Gabriel_Dropship_Orbit
isVisible: true
highPriorityQueue: true
pos: 0.1
ai_isDisabled: true



[hiddenAction_unload2]
autoTrigger: if self.isControlledByAI() and self.transportingCount(greaterThan=0) and self.hp(lessThan=6000) and not self.transportingUnitWithTags(includes='DreadN') and not self.hasFlag(id=1) and not self.tags(includes='Retreat') or self.isControlledByAI() and self.transportingCount(greaterThan=0) and not self.isFlying() and not self.transportingUnitWithTags(includes='DreadN') and not self.hasFlag(id=1) and not self.tags(includes='Retreat')
#Jettison regular units in danger or landed
startUnloadingTransport: true
clearAllWaypoints: false
addResources: setFlag=1
alsoQueueAction: finishedUnload



[hiddenAction_unload]
#jettison regular units to collect dreadnoughts
autoTrigger: if self.isControlledByAI() and self.transportingCount(greaterThan=0) and self.hasUnitInTeam(withTag='DreadP', greaterThan=0, withinRange=1000) and not self.transportingUnitWithTags(includes='DreadN') and self.hp(greaterThan=7000) and not self.hasFlag(id=1) and not self.tags(includes='Retreat')
startUnloadingTransport: true
clearAllWaypoints: true
addResources: setFlag=1
alsoQueueAction: finishedUnload



[hiddenAction_Collect]
autoTrigger: if self.isControlledByAI() and self.hasUnitInTeam(withTag='DreadP', greaterThan=0, withinRange=1000) and not self.transportingUnitWithTags(includes='Dread') and not self.transportingCount(greaterThan=0) and self.hp(greaterThan=7000) and not self.hasFlag(id=1) and not self.tags(includes='Retreat')


clearAllWaypoints: false
#clearActiveWaypoint: true

addWaypoint_prepend: true
addWaypoint_type: loadUp
addWaypoint_target_nearestUnit_maxRange: 1000
addWaypoint_target_nearestUnit_team: own
addWaypoint_target_nearestUnit_tagged: DreadP




[hiddenAction_attack]
autoTrigger: if self.isControlledByAI() and self.transportingUnitWithTags(includes='DreadP') and not self.hasActiveWaypoint(type='attack') and self.hp(greaterThan=7000) and not self.tags(includes='Retreat')
clearAllWaypoints: true
addWaypoint_prepend: false
addWaypoint_type: attack
addWaypoint_target_nearestUnit_maxRange: 9999
addWaypoint_target_nearestUnit_team: enemy
addWaypoint_target_nearestUnit_tagged: Building





[hiddenAction_unloadDread]
autoTrigger: if self.isControlledByAI() and self.transportingUnitWithTags(includes='DreadN') and numberOfUnitsInEnemyTeam(greaterThan=4, withinRange=600) and not self.hasFlag(id=1) or self.isControlledByAI() and self.transportingUnitWithTags(includes='DreadN') and numberOfUnitsInEnemyTeam(withTag='Titan', greaterThan=0, withinRange=600) and not self.hasFlag(id=1) or self.isControlledByAI() and self.transportingUnitWithTags(includes='DreadN') and self.hp(lessThan=7000) and not self.hasFlag(id=1) and not self.tags(includes='Retreat')
startUnloadingTransport: true
clearAllWaypoints: true
addResources: setFlag=1





[hiddenAction_resetFlags]
autoTrigger: if self.isControlledByAI() and not self.transportingCount(greaterThan=0) and self.hasFlag(id=1)
alsoQueueAction: finishedUnload


[hiddenAction_finishedUnload]
buildSpeed: 5s
addResources: unsetFlag=1



[hiddenAction_Healed]
autoTrigger: if self.isControlledByAI() and self.hp(greaterThan=8500)
temporarilyRemoveTags: Retreat

[hiddenAction_Damaged]
autoTrigger: if self.isControlledByAI() and self.hp(lessThan=5000)
temporarilyAddTags: Retreat


[hiddenAction_ReturnAI]
autoTrigger: if self.isControlledByAI() and not self.hasUnitInTeam(withTag='DreadP', greaterThan=0, withinRange=1000) and not self.transportingUnitWithTags(includes='DreadN')
temporarilyRemoveTags: Override

[hiddenAction_OverrideAI]
autoTrigger: if self.isControlledByAI() and self.hasUnitInTeam(withTag='DreadP', greaterThan=0, withinRange=1000) or self.isControlledByAI() and self.transportingUnitWithTags(includes='DreadN')
temporarilyAddTags: Override




[hiddenAction_unloadRetreat]
autoTrigger: if self.isControlledByAI() and self.transportingCount(greaterThan=0) and self.tags(includes='Retreat') and not self.hasFlag(id=1)


#Unload when near enemy base
[hiddenAction_unloadEnemy]
autoTrigger: false



#unload when near FormLeader
[hiddenAction_unloadFormation]
autoTrigger: false



[graphics]
drawLayer: experimentals

total_frames: 1

image:        G2.png
image_wreak:  G2_ruin.png
image_turret: Gabriel cannon.png
icon_zoomed_out: MapX.png

image_shadow: AUTO
shadowOffsetX:3
shadowOffsetY:3
movementEffect: CUSTOM:thrust
movementEffectRate: 1



[attack]
canAttack: true
canAttackFlyingUnits: true
canAttackLandUnits:   true
canAttackUnderwaterUnits: true

turretSize: 18
turretTurnSpeed: 4
maxAttackRange: 250
shootDelay: 5
turretMultiTargeting: true







[turret_1]
#nano turret
x: 0
y: -25
warmup:10
image: Gabriel nanogun.png

size: 20

canShoot: false
canAttackFlyingUnits: false
canAttackLandUnits:   false
canAttackUnderwaterUnits: false

turnSpeedAcceleration: 0.12

isMainNanoTurret: true







[turret_2]
#right rocket silo for ground mode only
x: 80
y: 60
canShoot: false
invisible: true
shoot_sound:missile_fire
shoot_sound_vol:0.1
shoot_light:#FFEECCCC

canAttackFlyingUnits: true
canAttackLandUnits:   true
canAttackUnderwaterUnits: false
projectile: 2
size: 1

turnSpeed: 40

energyUsage: 1

delay: 20
warmup: 20

shoot_flame:shockwave



[turret_3]
#left rocket silo
x: -80
y: 60
canShoot: false
invisible: true
shoot_sound:missile_fire
shoot_sound_vol:0.1
shoot_light:#FFEECCCC

canAttackFlyingUnits: true
canAttackLandUnits:   true
canAttackUnderwaterUnits: false
projectile: 2
size: 1

turnSpeed: 40

energyUsage: 1

delay: 20
linkDelayWithTurret: 2
warmup: 20

shoot_flame:shockwave





[turret_4]
x: -50
y: -50
canShoot: true

invisible: true

shoot_sound:plasma_fire
shoot_sound_vol:0.1
shoot_flame:small
shoot_light:#FFccCCEE

delay: 5
warmup: 5
projectile: 1

idleDir: -90
limitingAngle: 100





[turret_5]
x: 50
y: -50
canShoot: true

invisible: true

shoot_sound:plasma_fire
shoot_sound_vol:0.1
shoot_flame:small
shoot_light:#FFccCCEE

delay: 5
warmup: 5


idleDir: 90
limitingAngle: 100







[projectile_1]
#partical shot
directDamage: 15
life: 70
speed: 12

frame: 11

lightColor: #FFccCCEE
lightSize: 0.4





[projectile_2]
#missile
directDamage: 100

life: 1000
speed: 0.4
targetSpeed: 20
trailEffect: true
largeHitEffect: true
#ballistic: true
#ballistic_delaymove_height:65
#ballistic_height: 80
frame: 4

areaDamage: 380
areaRadius: 120

autoTargetingOnDeadTarget: true
deflectionPower: 4

initialUnguidedSpeedHeight: 3.2
gravity:1
#lightCastOnGround: true









[arm_1]
x:0
y:80
image_end:ramp.png
image_end_teamColors: true
drawOverBody: false






[arm_2]
x:-18
y:54
image_end:Pod_L.png
image_end_teamColors: true
drawOverBody: false



[arm_3]
x:18
y:54
image_end:Pod_R.png
image_end_teamColors: true
drawOverBody: false



[arm_4]
x:-43
y:54
image_end:hatch_L.png
image_end_teamColors: true
drawOverBody: false



[arm_5]
x:43
y:54
image_end:hatch_R.png
image_end_teamColors: true
drawOverBody: false







[effect_thrust]
image: thrust.png
life: 45
fadeOut: true
attachedToUnit: false
fadeInTime:1
drawUnderUnits:true
ySpeedRelative:-0.4
atmospheric: true






[movement]
movementType: AIR
moveSpeed: 0.8
moveAccelerationSpeed: 0.005
moveDecelerationSpeed: 0.02

landOnGround: true
targetHeight: 60

maxTurnSpeed: 1.3
turnAcceleration: 0.05

moveSlidingMode :true
moveIgnoringBody:true
moveSlidingDir:  45


slowDeathFall: true


[ai]
useAsBuilder: true

ai_upgradePriority: 0.1


